
# 准备域名

# 准备服务器

# 让外网访问本机(ngrock www.tunnel.mobel localtunnel pagekite 花生壳)

1. ngrok

2. localtunnel(通过这种方式可以将内网暴露给外网)
```
npm install localtunnel -g
lt --port 3100
```
缺点: 1. 一个是不支持自定义域名映射
     2. 另一个是映射以后,一旦本机服务终止,在重启以后, 会失去这个映射连接

3. tunnel.mobi


4. 终极解决方案: 自己动手在一台vpn上搭建一个自己的映射代理通道,但是这样会极大的增加新手的开发难度

##. 替代方案
1. 叫做utralhook的服务: http://www.utralhook.com
2. 下载qq浏览器, 在qq浏览器中有配套的解决方案(下载qq浏览器 -> 点击关于qq浏览器 -> 点击开发者工具 -> 里面有微信小图标-> 安装这个小图标->安装好之后点击服务器端调试->填写端口号并启动会得到外网的域名)




#配置公众账号
1. 如果没有的话可以用测试公众账号(http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html)
到这个网址里面的开发者工具里面可以申请一个接口测试号


#如何接入呢***********************(重要)
##接入流程一共分2步
1. 第一步 配置我们的微信公众号后台
```
 配置外网域名
 配置token
```
2. 第二步 验证公众号
```
验证公众账号的四个参数(微信传过来的)
signature
timestamp 时间戳
nonce 随机数
echostr 如果验证通过(是微信打开的),则返回echostr,继续下面的操作

第一步: 将token、timestamp、nonce三个参数进行字典排序
第二步: 将三个参数字符串拼接成一个字符串进行sha1加密
第三部: 将加密后的字符串与signature对比,如果相同,表示这个请求来源于微信,我们直接原样返回echostr参数内容,接入验证就成功了

```

#票据access_token打开新世界大门*********************(重要)
1. 可以看做是和微信交流的一把钥匙,几乎调用任何接口都需要用到

#access_token重要两点*************************(重要)
1. 第一点: access_token它每2(7200秒)个小时自动失效,需要重新获取。
2. 第二点: 只要更新了access_token, 之前的那个就不能用了

#解决access_token失效的问题
1. 让我们的系统每隔2个小时启动去刷新一次票据,这样无论何时我们内部调用接口,这个票据始终是最新的
2. 为了方便频繁调用, 我们需要把票据存储在一个地方,并且是唯一的一个地方


#小的demo************************************************
##五个步骤
第一: 处理POST类型的控制逻辑,接受这个XML的数据包
第二: 解析这个数据包(获得数据包的消息类型或者是事件类型)
第三: 拼装我们定义好的消息
第四: 包装成XML的格式
第五: 在5秒钟内返回回去

